---
import Layout from '@layouts/Default.astro';

// Define colors for styling
const colors = ['bg-pink', 'bg-blue', 'bg-green', 'bg-yellow', 'bg-purple'];
const randomColor = colors[Math.floor(Math.random() * colors.length)];

// Define images for the emotion guessing game
const images = [
    { src: 'https://i.pinimg.com/736x/fa/e9/6c/fae96c9ae39a45b5e82b8e543b9d0043.jpg', alt: 'Confused', emotion: 'confused' },
    { src: 'https://media.istockphoto.com/id/1045886560/photo/portrait-of-smiling-handsome-man-in-blue-t-shirt-standing-with-crossed-arms-isolated-on-grey.jpg?s=612x612&w=0&k=20&c=TX1-1UJ3PKonFEmgs_WDZf7wtfqKVMHYjeRaYjaZ1Rc=', alt: 'Happy', emotion: 'happy' },
    { src: 'https://c.stocksy.com/a/p7y400/z9/1184437.jpg', alt: 'Sad', emotion: 'sad' },
    { src: 'https://i.pinimg.com/736x/36/c3/3e/36c33e3ff7a210fdd48c57a7436cd61d.jpg', alt: 'Surprised', emotion: 'surprised' },
    { src: 'https://i.pinimg.com/736x/75/09/cd/7509cd625a684d1544aa7ca2b03809bc.jpg', alt: 'Determined', emotion: 'determined' },
    { src: 'https://i.pinimg.com/736x/65/e7/25/65e725cdfbff5c4faa067bd452a1e6cd.jpg', alt: 'Touched', emotion: 'touched' },
    { src: 'https://i.pinimg.com/736x/79/f1/6a/79f16a489aab154dd0b76b91d078f42b.jpg', alt: 'Sad', emotion: 'sad' }
];
---

<Layout
    title='Emotion'
    pageTitle='Stoorybook | Emotion'
    description='Emotion page'
>
    <main class={`p-6 min-h-screen flex flex-col items-center gap-8 ${randomColor}`}>
        <div class="max-w-7xl mx-auto">
            <header class="mb-8">
                <h1 class="text-6xl font-bold text-gray-800 mb-2">Emotion</h1>
                <p class="text-2xl text-gray-600">Guess the emotion</p>
            </header>
            
            <div class="mt-8">
                <h2 class="text-4xl font-bold text-gray-800 mb-4">Guess the Emotion</h2>
                <img src="" alt="" class="emotion-image w-full h-64 object-cover mb-4" />
                <div class="grid grid-cols-2 gap-4" id="options-container">
                    <!-- Options will be dynamically inserted here -->
                </div>
                <p id="result" class="mt-4 text-xl"></p>
            </div>
        </div>
    </main>
</Layout>

<script>
    const images = [
        { src: 'https://i.pinimg.com/736x/fa/e9/6c/fae96c9ae39a45b5e82b8e543b9d0043.jpg', alt: 'Confused', emotion: 'confused' },
        { src: 'https://media.istockphoto.com/id/1045886560/photo/portrait-of-smiling-handsome-man-in-blue-t-shirt-standing-with-crossed-arms-isolated-on-grey.jpg?s=612x612&w=0&k=20&c=TX1-1UJ3PKonFEmgs_WDZf7wtfqKVMHYjeRaYjaZ1Rc=', alt: 'Happy', emotion: 'happy' },
        { src: 'https://c.stocksy.com/a/p7y400/z9/1184437.jpg', alt: 'Sad', emotion: 'sad' },
        { src: 'https://i.pinimg.com/736x/36/c3/3e/36c33e3ff7a210fdd48c57a7436cd61d.jpg', alt: 'Surprised', emotion: 'surprised' },
        { src: 'https://i.pinimg.com/736x/75/09/cd/7509cd625a684d1544aa7ca2b03809bc.jpg', alt: 'Determined', emotion: 'determined' },
        { src: 'https://i.pinimg.com/736x/65/e7/25/65e725cdfbff5c4faa067bd452a1e6cd.jpg', alt: 'Touched', emotion: 'touched' },
        { src: 'https://i.pinimg.com/736x/79/f1/6a/79f16a489aab154dd0b76b91d078f42b.jpg', alt: 'Sad', emotion: 'sad' }
    ];

    let currentRound = 0;
    let selectedImage = null;
    const usedIndices = new Set();

    function getRandomOptions(correctEmotion) {
        const allEmotions = [...new Set(images.map(img => img.emotion))];
        const options = [correctEmotion];
        
        // Remove the correct emotion from the pool
        const remainingEmotions = allEmotions.filter(emotion => emotion !== correctEmotion);
        
        // Randomly select 3 more emotions
        while (options.length < 4 && remainingEmotions.length > 0) {
            const randomIndex = Math.floor(Math.random() * remainingEmotions.length);
            options.push(remainingEmotions[randomIndex]);
            remainingEmotions.splice(randomIndex, 1);
        }
        
        // Shuffle the options
        return options.sort(() => Math.random() - 0.5);
    }

    function updateRound() {
        // Find an unused image
        let newIndex;
        do {
            newIndex = Math.floor(Math.random() * images.length);
        } while (usedIndices.has(newIndex) && usedIndices.size < images.length);
        
        usedIndices.add(newIndex);
        selectedImage = images[newIndex];

        const imageElement = document.querySelector('.emotion-image');
        const optionsContainer = document.getElementById('options-container');
        const resultElement = document.getElementById('result');

        if (imageElement && optionsContainer && resultElement) {
            imageElement.src = selectedImage.src;
            imageElement.alt = selectedImage.alt;
            resultElement.textContent = '';

            const options = getRandomOptions(selectedImage.emotion);
            optionsContainer.innerHTML = options.map(emotion => `
                <button 
                    class="emotion-option p-4 bg-gray-200 rounded hover:bg-gray-300 transition-colors" 
                    onclick="checkAnswer('${emotion}')"
                >
                    ${emotion}
                </button>
            `).join('');
        }
    }

    function checkAnswer(selectedEmotion) {
        const correctEmotion = selectedImage.emotion;
        const resultElement = document.getElementById('result');
        
        if (resultElement) {
            if (selectedEmotion === correctEmotion) {
                resultElement.textContent = 'Correct! ðŸŽ‰';
            } else {
                resultElement.textContent = 'Try again! ðŸ˜¢';
            }
        }

        setTimeout(() => {
            if (currentRound < images.length - 1) {
                currentRound++;
                updateRound();
            } else {
                resultElement.textContent = 'Quiz completed!';
                // Disable all buttons
                document.querySelectorAll('.emotion-option').forEach(button => {
                    button.disabled = true;
                });
            }
        }, 1500);
    }

    // Start the game when the page loads
    document.addEventListener('DOMContentLoaded', updateRound);
</script>

<style>
    .emotion-image {
        width: 200px;
        height: 200px;
        object-fit: cover;
    }
    .emotion-option {
        cursor: pointer;
        text-align: center;
    }
    .emotion-option:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }
</style>
